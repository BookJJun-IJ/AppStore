name: nextcloud

services:
  nextcloud:
    image: nextcloud:30.0.6
    user: $PUID:$PGID
    depends_on:
      - db
    deploy:
      resources:
        limits:
          memory: 1024M
          cpus: '1.0'
    expose:
      - 80
    environment:
      - PUID=$PUID
      - PGID=$PGID
      - TZ=$TZ
      - MYSQL_HOST=db
      - MYSQL_DATABASE=nextcloud
      - MYSQL_USER=nextcloud
      - MYSQL_PASSWORD=$default_pwd
      - NEXTCLOUD_TRUSTED_DOMAINS=localhost,$domain
      - OVERWRITEPROTOCOL=https
      - OVERWRITEHOST=$domain
      - TRUSTED_PROXIES=172.16.0.0/12,10.0.0.0/8,192.168.0.0/16
    volumes:
      - /DATA/AppData/nextcloud/html:/var/www/html
      - /DATA/AppData/nextcloud/apps:/var/www/html/custom_apps
      - /DATA/AppData/nextcloud/config:/var/www/html/config
      - /DATA/AppData/nextcloud/data:/var/www/html/data
      - /DATA/Documents:/var/www/html/data/Documents
      - /DATA/Media:/var/www/html/data/Media
      - /DATA/Gallery:/var/www/html/data/Gallery
    restart: unless-stopped
    networks:
      - nextcloud-network

  db:
    image: mariadb:11.2
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '0.5'
    environment:
      - TZ=$TZ
      - MYSQL_ROOT_PASSWORD=$default_pwd
      - MYSQL_DATABASE=nextcloud
      - MYSQL_USER=nextcloud
      - MYSQL_PASSWORD=$default_pwd
      - MARIADB_AUTO_UPGRADE=1
    volumes:
      - /DATA/AppData/nextcloud/db:/var/lib/mysql
    restart: unless-stopped
    networks:
      - nextcloud-network

  collabora:
    image: collabora/code:24.04.9.1.1
    depends_on:
      - nextcloud
    deploy:
      resources:
        limits:
          memory: 1024M
          cpus: '1.0'
    expose:
      - 9980
    environment:
      - TZ=$TZ
      - domain=localhost
      - DONT_GEN_SSL_CERT=true
      - extra_params=--o:ssl.enable=false --o:ssl.termination=true --o:welcome.enable=false
    volumes:
      - /DATA/AppData/nextcloud/collabora:/tmp
    restart: unless-stopped
    networks:
      - nextcloud-network

networks:
  nextcloud-network:
    driver: bridge

x-casaos:
  main: nextcloud
  webui_port: 80
  category: Utilities
  architectures: [amd64, arm64]
  author: Yundera Team
  developer: Nextcloud GmbH
  description:
    en_us: Nextcloud is a suite of client-server software for creating and using file hosting services. It offers functionality similar to Dropbox, Office 365 or Google Drive when used with integrated office suites.
    ko_kr: Nextcloud는 파일 호스팅 서비스를 생성하고 사용하기 위한 클라이언트-서버 소프트웨어 제품군입니다. 통합 오피스 제품군과 함께 사용하면 Dropbox, Office 365 또는 Google Drive와 유사한 기능을 제공합니다.
  title:
    en_us: Nextcloud
  tagline:
    en_us: A safe home for all your data
    ko_kr: 모든 데이터를 위한 안전한 보금자리
  icon: https://cdn.jsdelivr.net/gh/Yundera/AppStore@main/Apps/Nextcloud/icon.png
  screenshot: https://cdn.jsdelivr.net/gh/Yundera/AppStore@main/Apps/Nextcloud/screenshot-1.png
  thumbnail: https://cdn.jsdelivr.net/gh/Yundera/AppStore@main/Apps/Nextcloud/thumbnail.png
  tips:
    before_install:
      en_us: |
        Setup Steps:
        1. Access web interface after installation
        2. Complete setup wizard (create admin account)
        3. If infinite loading occurs, restart the app
        4. Collabora Office included for document editing
        
        Features:
        - File sharing and collaboration
        - Calendar and contacts
        - Real-time document editing
        - NSL Router optimized
        
        Database (auto-configured):
        Host: db | Database: nextcloud | User: nextcloud
      ko_kr: |
        설정 단계:
        1. 설치 후 웹 인터페이스 접속
        2. 설정 마법사 완료 (관리자 계정 생성)
        3. 무한 로딩 발생 시 앱 재시작
        4. 문서 편집용 Collabora Office 포함
        
        기능:
        - 파일 공유 및 협업
        - 캘린더 및 연락처
        - 실시간 문서 편집
        - NSL Router 최적화
        
        데이터베이스 (자동 구성):
        호스트: db | 데이터베이스: nextcloud | 사용자: nextcloud
  index: /