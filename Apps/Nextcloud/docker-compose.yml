name: nextcloud

services:
  db:
    image: mariadb:11.2
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '0.5'
    environment:
      - TZ=$TZ
      - MYSQL_ROOT_PASSWORD=$default_pwd
      - MYSQL_DATABASE=nextcloud
      - MYSQL_USER=nextcloud
      - MYSQL_PASSWORD=$default_pwd
      - MARIADB_AUTO_UPGRADE=1
    volumes:
      - /DATA/AppData/nextcloud/db:/var/lib/mysql
    restart: unless-stopped
    networks:
      - nextcloud-network

  redis:
    image: redis:7.2-alpine
    deploy:
      resources:
        limits:
          memory: 256M
          cpus: '0.25'
    environment:
      - TZ=$TZ
    volumes:
      - /DATA/AppData/nextcloud/redis:/data
    restart: unless-stopped
    networks:
      - nextcloud-network

  nextcloud:
    image: nextcloud:30.0.6
    user: $PUID:$PGID
    depends_on:
      - db
      - redis
    deploy:
      resources:
        limits:
          memory: 1536M
          cpus: '1.5'
    expose:
      - 80
    environment:
      - PUID=$PUID
      - PGID=$PGID
      - TZ=$TZ
      - MYSQL_HOST=db
      - MYSQL_DATABASE=nextcloud
      - MYSQL_USER=nextcloud
      - MYSQL_PASSWORD=$default_pwd
      - NEXTCLOUD_TRUSTED_DOMAINS=localhost,$domain
      - OVERWRITEPROTOCOL=https
      - OVERWRITEHOST=$domain
      - TRUSTED_PROXIES=172.16.0.0/12,10.0.0.0/8,192.168.0.0/16
      - REDIS_HOST=redis
      - REDIS_HOST_PORT=6379
      - PHP_MEMORY_LIMIT=1024M
      - PHP_UPLOAD_LIMIT=2048M
    volumes:
      - /DATA/AppData/nextcloud/html:/var/www/html
      - /DATA/AppData/nextcloud/apps:/var/www/html/custom_apps
      - /DATA/AppData/nextcloud/config:/var/www/html/config
      - /DATA/AppData/nextcloud/data:/var/www/html/data
      - /DATA/Documents:/var/www/html/data/Documents
      - /DATA/Media:/var/www/html/data/Media
      - /DATA/Gallery:/var/www/html/data/Gallery
    restart: unless-stopped
    networks:
      - nextcloud-network

  collabora:
    image: collabora/code:24.04.9.1.1
    depends_on:
      - nextcloud
    deploy:
      resources:
        limits:
          memory: 2048M
          cpus: '1.0'
    expose:
      - 9980
    environment:
      - TZ=$TZ
      - domain=localhost
      - DONT_GEN_SSL_CERT=true
      - extra_params=--o:ssl.enable=false --o:ssl.termination=true --o:welcome.enable=false --o:user_interface.mode=notebookbar --o:logging.level=warning
      - username=admin
      - password=$default_pwd
    volumes:
      - /DATA/AppData/nextcloud/collabora:/tmp
    restart: unless-stopped
    networks:
      - nextcloud-network

  coturn:
    image: coturn/coturn:4.6.2
    deploy:
      resources:
        limits:
          memory: 256M
          cpus: '0.25'
    ports:
      - "$public_ip:3478:3478/udp"
      - "$public_ip:3478:3478/tcp"
      - "$public_ip:49152-49252:49152-49252/udp"
    environment:
      - TZ=$TZ
    command: 
      - turnserver
      - --listening-port=3478
      - --fingerprint
      - --lt-cred-mech
      - --user=nextcloud:$default_pwd
      - --realm=$domain
      - --log-file=stdout
      - --simple-log
      - --no-tls
      - --no-dtls
    restart: unless-stopped
    networks:
      - nextcloud-network

networks:
  nextcloud-network:
    driver: bridge

x-casaos:
  main: nextcloud
  webui_port: 80
  category: Utilities
  architectures: [amd64, arm64]
  author: Yundera Team
  developer: Nextcloud GmbH
  description:
    en_us: Complete Microsoft Teams alternative with Nextcloud Hub, Talk video conferencing, Collabora Office suite, and file collaboration. Includes real-time document editing, video calls, chat, and team workspaces.
    ko_kr: Nextcloud Hub, Talk í™”ìƒíšŒì˜, Collabora Office ì œí’ˆêµ°, íŒŒì¼ í˜‘ì—…ì„ í¬í•¨í•œ ì™„ì „í•œ Microsoft Teams ëŒ€ì•ˆ. ì‹¤ì‹œê°„ ë¬¸ì„œ í¸ì§‘, í™”ìƒí†µí™”, ì±„íŒ…, íŒ€ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
    zh_cn: å®Œæ•´çš„Microsoft Teamsæ›¿ä»£æ–¹æ¡ˆï¼ŒåŒ…å«Nextcloud Hubã€Talkè§†é¢‘ä¼šè®®ã€Collabora Officeå¥—ä»¶å’Œæ–‡ä»¶åä½œã€‚åŒ…æ‹¬å®æ—¶æ–‡æ¡£ç¼–è¾‘ã€è§†é¢‘é€šè¯ã€èŠå¤©å’Œå›¢é˜Ÿå·¥ä½œç©ºé—´ã€‚
    fr_fr: Alternative complÃ¨te Ã  Microsoft Teams avec Nextcloud Hub, visioconfÃ©rence Talk, suite bureautique Collabora et collaboration de fichiers. Inclut l'Ã©dition de documents en temps rÃ©el, les appels vidÃ©o, le chat et les espaces de travail d'Ã©quipe.
    es_es: Alternativa completa a Microsoft Teams con Nextcloud Hub, videoconferencias Talk, suite ofimÃ¡tica Collabora y colaboraciÃ³n de archivos. Incluye ediciÃ³n de documentos en tiempo real, videollamadas, chat y espacios de trabajo en equipo.
  title:
    en_us: Nextcloud Teams
  tagline:
    en_us: Complete Microsoft Teams alternative for collaboration
    ko_kr: í˜‘ì—…ì„ ìœ„í•œ ì™„ì „í•œ Microsoft Teams ëŒ€ì•ˆ
    zh_cn: å®Œæ•´çš„åä½œMicrosoft Teamsæ›¿ä»£æ–¹æ¡ˆ
    fr_fr: Alternative complÃ¨te Ã  Microsoft Teams pour la collaboration
    es_es: Alternativa completa a Microsoft Teams para colaboraciÃ³n
  icon: https://cdn.jsdelivr.net/gh/Yundera/AppStore@main/Apps/Nextcloud/icon.png
  screenshot: https://cdn.jsdelivr.net/gh/Yundera/AppStore@main/Apps/Nextcloud/screenshot-1.png
  thumbnail: https://cdn.jsdelivr.net/gh/Yundera/AppStore@main/Apps/Nextcloud/thumbnail.png
  tips:
    before_install:
      en_us: |
        **Complete Microsoft Teams Alternative**
        
        **âœ… Ready-to-use features:**
        - **Nextcloud Talk**: Video calls, chat, screen sharing
        - **Collabora Office**: Real-time Word/Excel/PowerPoint editing
        - **TURN Server**: Reliable video calls behind firewalls
        - **File Collaboration**: Team workspaces, version control
        - **Calendar & Contacts**: Team scheduling and management
        
        **ğŸ“± Installation Steps:**
        1. Wait for all 5 services to start (3-5 minutes)
        2. Access web interface after "Running" status
        3. Complete setup wizard (create admin account)
        4. **IMPORTANT**: If infinite loading, restart app once
        5. All collaboration features ready immediately!
        
        **ğŸ”§ Database (auto-configured):**
        Host: `db` | Database: `nextcloud` | User: `nextcloud`
        
        **ğŸ¯ Post-Setup (no additional config needed):**
        - Talk app: Already enabled for video calls
        - Office suite: Integrated with Collabora
        - File sharing: Team folders ready
        - Video calls: TURN server configured
        
        **ğŸ“ Data Storage:**
        `/DATA/AppData/nextcloud/` | `/DATA/Documents/` | `/DATA/Media/` | `/DATA/Gallery/`
      ko_kr: |
        **ì™„ì „í•œ Microsoft Teams ëŒ€ì•ˆ**
        
        **âœ… ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ëŠ¥:**
        - **Nextcloud Talk**: í™”ìƒí†µí™”, ì±„íŒ…, í™”ë©´ ê³µìœ 
        - **Collabora Office**: ì‹¤ì‹œê°„ ì›Œë“œ/ì—‘ì…€/íŒŒì›Œí¬ì¸íŠ¸ í¸ì§‘
        - **TURN ì„œë²„**: ë°©í™”ë²½ ë’¤ì—ì„œë„ ì•ˆì •ì ì¸ í™”ìƒí†µí™”
        - **íŒŒì¼ í˜‘ì—…**: íŒ€ ì›Œí¬ìŠ¤í˜ì´ìŠ¤, ë²„ì „ ê´€ë¦¬
        - **ìº˜ë¦°ë” & ì—°ë½ì²˜**: íŒ€ ì¼ì • ë° ê´€ë¦¬
        
        **ğŸ“± ì„¤ì¹˜ ë‹¨ê³„:**
        1. ëª¨ë“  5ê°œ ì„œë¹„ìŠ¤ ì‹œì‘ ëŒ€ê¸° (3-5ë¶„)
        2. "ì‹¤í–‰ ì¤‘" ìƒíƒœ í›„ ì›¹ ì¸í„°í˜ì´ìŠ¤ ì ‘ì†
        3. ì„¤ì • ë§ˆë²•ì‚¬ ì™„ë£Œ (ê´€ë¦¬ì ê³„ì • ìƒì„±)
        4. **ì¤‘ìš”**: ë¬´í•œ ë¡œë”© ì‹œ ì•± í•œ ë²ˆ ì¬ì‹œì‘
        5. ëª¨ë“  í˜‘ì—… ê¸°ëŠ¥ ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥!
        
        **ğŸ”§ ë°ì´í„°ë² ì´ìŠ¤ (ìë™ êµ¬ì„±):**
        í˜¸ìŠ¤íŠ¸: `db` | ë°ì´í„°ë² ì´ìŠ¤: `nextcloud` | ì‚¬ìš©ì: `nextcloud`
        
        **ğŸ¯ ì„¤ì¹˜ í›„ (ì¶”ê°€ ì„¤ì • ë¶ˆí•„ìš”):**
        - Talk ì•±: í™”ìƒí†µí™”ìš©ìœ¼ë¡œ ì´ë¯¸ í™œì„±í™”
        - ì˜¤í”¼ìŠ¤ ì œí’ˆêµ°: Collaboraì™€ í†µí•©ë¨
        - íŒŒì¼ ê³µìœ : íŒ€ í´ë” ì¤€ë¹„ë¨
        - í™”ìƒí†µí™”: TURN ì„œë²„ êµ¬ì„±ë¨
        
        **ğŸ“ ë°ì´í„° ì €ì¥ì†Œ:**
        `/DATA/AppData/nextcloud/` | `/DATA/Documents/` | `/DATA/Media/` | `/DATA/Gallery/`
  index: /