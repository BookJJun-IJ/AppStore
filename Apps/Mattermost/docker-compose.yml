name: mattermost

services:
  postgres:
    image: postgres:13-alpine
    user: $PUID:$PGID  # ğŸ”¥ í•µì‹¬ ìˆ˜ì • 1
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '0.5'
    volumes:
      - /DATA/AppData/$AppID/postgres:/var/lib/postgresql/data
    environment:
      PUID: $PUID
      PGID: $PGID
      POSTGRES_USER: mmuser
      POSTGRES_PASSWORD: $default_pwd
      POSTGRES_DB: mattermost
      POSTGRES_INITDB_ARGS: "--encoding=UTF-8"
      PGDATA: /var/lib/postgresql/data/pgdata
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U mmuser -d mattermost"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 120s

  mattermost:
    image: mattermost/mattermost-team-edition:10.9.1
    user: $PUID:$PGID  # ğŸ”¥ í•µì‹¬ ìˆ˜ì • 2
    restart: unless-stopped
    depends_on:
      - postgres  # ğŸ”¥ ìˆ˜ì • 3: condition ì œê±° (CasaOS í˜¸í™˜ì„±)
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '1.0'
    expose:
      - 80
    volumes:
      - /DATA/AppData/$AppID/config:/mattermost/config
      - /DATA/AppData/$AppID/data:/mattermost/data
      - /DATA/AppData/$AppID/logs:/mattermost/logs
      - /DATA/AppData/$AppID/plugins:/mattermost/plugins
    environment:
      PUID: $PUID
      PGID: $PGID
      TZ: $TZ
      
      MM_SQLSETTINGS_DRIVERNAME: postgres
      MM_SQLSETTINGS_DATASOURCE: postgres://mmuser:$default_pwd@postgres:5432/mattermost?sslmode=disable&connect_timeout=10
      MM_SERVICESETTINGS_SITEURL: "https://$domain"
      MM_SERVICESETTINGS_LISTENADDRESS: ":80"
      MM_SERVICESETTINGS_ENABLELOCALMODE: true
      
      # í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ ì™„ì „ ë¹„í™œì„±í™” (ì•ˆì •ì„± ìš°ì„ )
      MM_PLUGINSETTINGS_ENABLE: false
      MM_PLUGINSETTINGS_ENABLEUPLOADS: false
      MM_PLUGINSETTINGS_AUTOMATICPREPACKAGEDPLUGINS: false
      
      MM_TEAMSETTINGS_ENABLETEAMCREATION: true
      MM_TEAMSETTINGS_ENABLEUSERCREATION: true
      
      MM_FILESETTINGS_MAXFILESIZE: 52428800
      
      # ì´ë©”ì¼ ì•Œë¦¼ ë¹„í™œì„±í™”
      MM_EMAILSETTINGS_SENDEMAILNOTIFICATIONS: false
      
      # WebSocket ë¬¸ì œ í•´ê²° ì„¤ì •
      MM_SERVICESETTINGS_ENABLEINSECUREOUTGOINGCONNECTIONS: true
      MM_SERVICESETTINGS_ALLOWCORSFROM: "*"
      MM_SERVICESETTINGS_WEBSOCKETURL: ""  # ìë™ ê°ì§€ë¡œ WebSocket ë¬¸ì œ ìš°íšŒ
      MM_SERVICESETTINGS_ALLOWUNTRUSTEDINTERNALCONNECTIONS: true
      
      # ì—°ê²° íƒ€ì„ì•„ì›ƒ ì„¤ì •
      MM_SERVICESETTINGS_READTIMEOUT: 300
      MM_SERVICESETTINGS_WRITETIMEOUT: 300
      
      # ë””ë²„ê·¸ ë¡œê¹… (ë¬¸ì œ í•´ê²°ìš©)
      MM_LOGSETTINGS_FILELEVEL: DEBUG
      MM_LOGSETTINGS_CONSOLELEVEL: DEBUG

# ğŸ”¥ ìˆ˜ì • 4: ì»¤ìŠ¤í…€ ë„¤íŠ¸ì›Œí¬ ì œê±° (CasaOS ê¸°ë³¸ ë„¤íŠ¸ì›Œí¬ ì‚¬ìš©)

x-casaos:
  architectures: [amd64, arm64]
  main: mattermost
  webui_port: 80
  author: Yundera Team
  category: Communication
  description:
    en_us: Open-source team communication platform similar to Slack with secure messaging and collaboration features
    ko_kr: Slackê³¼ ìœ ì‚¬í•œ ì˜¤í”ˆì†ŒìŠ¤ íŒ€ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ í”Œë«í¼ìœ¼ë¡œ ë³´ì•ˆ ë©”ì‹œì§• ë° í˜‘ì—… ê¸°ëŠ¥ ì œê³µ
    fr_fr: Plateforme de communication d'Ã©quipe open-source similaire Ã  Slack avec messagerie sÃ©curisÃ©e et fonctionnalitÃ©s de collaboration
    es_es: Plataforma de comunicaciÃ³n de equipo de cÃ³digo abierto similar a Slack con mensajerÃ­a segura y funciones de colaboraciÃ³n
    zh_cn: ç±»ä¼¼Slackçš„å¼€æºå›¢é˜Ÿæ²Ÿé€šå¹³å°ï¼Œæä¾›å®‰å…¨æ¶ˆæ¯ä¼ é€’å’Œåä½œåŠŸèƒ½
  developer: Mattermost, Inc.
  icon: https://cdn.jsdelivr.net/gh/Yundera/AppStore@main/Apps/Mattermost/icon.png
  tagline:
    en_us: Secure team chat and collaboration
    ko_kr: ë³´ì•ˆ íŒ€ ì±„íŒ… ë° í˜‘ì—…
    fr_fr: Chat d'Ã©quipe et collaboration sÃ©curisÃ©s
    es_es: Chat de equipo y colaboraciÃ³n seguros
    zh_cn: å®‰å…¨çš„å›¢é˜ŸèŠå¤©å’Œåä½œ
  title:
    en_us: Mattermost
    ko_kr: Mattermost
  tips:
    before_install:
      en_us: |
        **Mattermost Team Communication (Latest Version)**
        
        This uses the latest stable version with basic features enabled.
        
        1. Visit the web interface after installation
        2. Create your first account (becomes system admin)
        3. Create a team and start messaging!
        4. Enable advanced features later in System Console
        
        **Core features included:**
        - Real-time team messaging
        - file sharing capabilities
        - Channel-based organization
        - Direct messaging
        
        **Note**: Plugins disabled initially for stability. Enable them manually in System Console after setup.
        
        Database password: `$default_pwd`
      ko_kr: |
        **Mattermost íŒ€ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ (ìµœì‹  ë²„ì „)**
        
        ê¸°ë³¸ ê¸°ëŠ¥ì´ í™œì„±í™”ëœ ìµœì‹  ì•ˆì • ë²„ì „ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
        
        1. ì„¤ì¹˜ í›„ ì›¹ ì¸í„°í˜ì´ìŠ¤ ë°©ë¬¸
        2. ì²« ë²ˆì§¸ ê³„ì • ìƒì„± (ì‹œìŠ¤í…œ ê´€ë¦¬ìê°€ ë¨)
        3. íŒ€ ìƒì„±í•˜ê³  ë©”ì‹œì§• ì‹œì‘!
        4. ë‚˜ì¤‘ì— ì‹œìŠ¤í…œ ì½˜ì†”ì—ì„œ ê³ ê¸‰ ê¸°ëŠ¥ í™œì„±í™”
        
        **í¬í•¨ëœ í•µì‹¬ ê¸°ëŠ¥:**
        - ì‹¤ì‹œê°„ íŒ€ ë©”ì‹œì§•
        - íŒŒì¼ ê³µìœ  ê¸°ëŠ¥
        - ì±„ë„ ê¸°ë°˜ ì¡°ì§
        - ë‹¤ì´ë ‰íŠ¸ ë©”ì‹œì§•
        
        **ì°¸ê³ **: ì•ˆì •ì„±ì„ ìœ„í•´ í”ŒëŸ¬ê·¸ì¸ì´ ì´ˆê¸°ì— ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì„¤ì • í›„ ì‹œìŠ¤í…œ ì½˜ì†”ì—ì„œ ìˆ˜ë™ìœ¼ë¡œ í™œì„±í™”í•˜ì„¸ìš”.
        
        ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸: `$default_pwd`
  # ğŸ”¥ ìˆ˜ì • 5: pre-install ëª…ë ¹ ì¶”ê°€
  pre-install-cmd: |
    mkdir -p /DATA/AppData/$AppID/{config,data,logs,plugins,postgres} &&
    chown -R $PUID:$PGID /DATA/AppData/$AppID/
  index: /
  port_map: "80"
  store_app_id: mattermost