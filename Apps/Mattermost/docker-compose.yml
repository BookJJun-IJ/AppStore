name: mattermost

services:
  postgres:
    image: postgres:13-alpine
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '0.5'
    volumes:
      - /DATA/AppData/$AppID/postgres:/var/lib/postgresql/data
    environment:
      POSTGRES_USER: mmuser
      POSTGRES_PASSWORD: $default_pwd
      POSTGRES_DB: mattermost
      POSTGRES_INITDB_ARGS: "--encoding=UTF-8"
      PGDATA: /var/lib/postgresql/data/pgdata
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U mmuser -d mattermost"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 120s

  mattermost:
    image: mattermost/mattermost-team-edition:10.9.1
    restart: unless-stopped
    depends_on:
      - postgres
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '1.0'
    expose:
      - 3000
    volumes:
      - /DATA/AppData/$AppID/config:/mattermost/config
      - /DATA/AppData/$AppID/data:/mattermost/data
      - /DATA/AppData/$AppID/logs:/mattermost/logs
      - /DATA/AppData/$AppID/plugins:/mattermost/plugins
      - /DATA/AppData/$AppID/client-plugins:/mattermost/client/plugins
    environment:
      PUID: $PUID
      PGID: $PGID
      TZ: $TZ
      MM_SQLSETTINGS_DRIVERNAME: postgres
      MM_SQLSETTINGS_DATASOURCE: postgres://mmuser:$default_pwd@postgres:5432/mattermost?sslmode=disable&connect_timeout=10
      MM_SERVICESETTINGS_SITEURL: "https://3000-$domain"
      MM_SERVICESETTINGS_LISTENADDRESS: ":3000"
      MM_SERVICESETTINGS_ENABLELOCALMODE: true
      MM_SERVICESETTINGS_ALLOWUNTRUSTEDINTERNALCONNECTIONS: true
      MM_SERVICESETTINGS_ENABLEINSECUREOUTGOINGCONNECTIONS: true
      MM_SERVICESETTINGS_ALLOWCORSFROM: "*"
      MM_SERVICESETTINGS_WEBSOCKETURL: ""
      MM_SERVICESETTINGS_ENABLEFILEATTACHMENTS: true
      MM_PLUGINSETTINGS_ENABLE: true
      MM_PLUGINSETTINGS_ENABLEUPLOADS: true
      MM_PLUGINSETTINGS_AUTOMATICPREPACKAGEDPLUGINS: true
      MM_PLUGINSETTINGS_ENABLEREMOTEMARKETPLACE: true
      MM_FILESETTINGS_MAXFILESIZE: 104857600
      MM_FILESETTINGS_ENABLEFILEATTACHMENTS: true
      MM_FILESETTINGS_ENABLEPUBLICLINK: true
      MM_TEAMSETTINGS_ENABLETEAMCREATION: true
      MM_TEAMSETTINGS_ENABLEUSERCREATION: true
      MM_EMAILSETTINGS_SENDEMAILNOTIFICATIONS: false
      MM_LOGSETTINGS_CONSOLELEVEL: "INFO"
      MM_LOGSETTINGS_FILELEVEL: "INFO"
      # Calls 플러그인 설정 - 테스트 모드 비활성화
      MM_PLUGINSETTINGS_PLUGINS_COM_MATTERMOST_CALLS_ENABLEPLUGIN: true
      MM_PLUGINSETTINGS_PLUGINS_COM_MATTERMOST_CALLS_ALLOWUSERSTOSTARTCALLS: true
      MM_PLUGINSETTINGS_PLUGINS_COM_MATTERMOST_CALLS_TESTMODE: false
      MM_PLUGINSETTINGS_PLUGINS_COM_MATTERMOST_CALLS_DEFAULTENABLED: true
      MM_PLUGINSETTINGS_PLUGINS_COM_MATTERMOST_CALLS_ALLOWSCREENSHARING: true

x-casaos:
  architectures: [amd64, arm64]
  main: mattermost
  webui_port: 3000
  author: Yundera Team
  category: Communication
  pre-install-cmd: |
    mkdir -p /DATA/AppData/$AppID/client-plugins &&
    mkdir -p /DATA/AppData/$AppID/config &&
    mkdir -p /DATA/AppData/$AppID/data &&
    mkdir -p /DATA/AppData/$AppID/logs &&
    mkdir -p /DATA/AppData/$AppID/plugins &&
    chmod -R 755 /DATA/AppData/$AppID/
  description:
    en_us: Self-hosted Microsoft Teams alternative with voice calls, video calls, screen sharing and team collaboration
    ko_kr: 음성 통화, 화상 통화, 화면 공유 및 팀 협업 기능을 갖춘 자체 호스팅 Microsoft Teams 대체 솔루션
    fr_fr: Alternative auto-hébergée à Microsoft Teams avec appels vocaux, appels vidéo, partage d'écran et collaboration d'équipe
    es_es: Alternativa auto-alojada a Microsoft Teams con llamadas de voz, videollamadas, intercambio de pantalla y colaboración en equipo
    zh_cn: 具有语音通话、视频通话、屏幕共享和团队协作功能的自托管Microsoft Teams替代方案
  developer: Mattermost, Inc.
  icon: https://cdn.jsdelivr.net/gh/Yundera/AppStore@main/Apps/Mattermost/icon.png
  tagline:
    en_us: Microsoft Teams alternative with calling features
    ko_kr: 통화 기능을 갖춘 Microsoft Teams 대체 솔루션
    fr_fr: Alternative à Microsoft Teams avec fonctionnalités d'appel
    es_es: Alternativa a Microsoft Teams con funciones de llamada
    zh_cn: 具有通话功能的Microsoft Teams替代方案
  title:
    en_us: Mattermost
    ko_kr: Mattermost
  tips:
    before_install:
      en_us: |
        **Mattermost Teams Alternative**
        
        Ready for Microsoft Teams migration with enterprise features:
        
        🚀 **Core Features:**
        - Team channels & direct messaging
        - File sharing (100MB per file)
        - Mobile & desktop apps
        - Plugin marketplace access
        - Advanced notifications
        
        📞 **Voice & Video Calls Setup:**
        Calling features are automatically enabled and configured:
        - Voice calls, video calls, and screen sharing ready
        - No manual plugin installation required
        - Test mode disabled for all users
        
        📋 **Quick Start:**
        1. Access: https://3000-mattermost-username.nsl.sh/
        2. Create admin account (first user becomes admin)
        3. Create your team/organization
        4. Start using voice/video calls immediately!
        
        🎯 **Teams vs Mattermost:**
        - ✅ No per-user licensing fees
        - ✅ Complete data ownership
        - ✅ Better performance (self-hosted)
        - ✅ Full customization control
        
        Database password: $default_pwd
      ko_kr: |
        **Mattermost Teams 대체 솔루션**
        
        엔터프라이즈 기능을 갖춘 Microsoft Teams 마이그레이션 준비:
        
        🚀 **핵심 기능:**
        - 팀 채널 및 다이렉트 메시징
        - 파일 공유 (파일당 100MB)
        - 모바일 및 데스크톱 앱
        - 플러그인 마켓플레이스 접근
        - 고급 알림 시스템
        
        📞 **음성 및 화상 통화 설정:**
        통화 기능이 자동으로 활성화되고 구성됩니다:
        - 음성 통화, 화상 통화, 화면 공유 준비 완료
        - 수동 플러그인 설치 불필요
        - 모든 사용자를 위해 테스트 모드 비활성화
        
        📋 **빠른 시작:**
        1. 접속: https://3000-mattermost-username.nsl.sh/
        2. 관리자 계정 생성 (첫 사용자가 관리자가 됨)
        3. 팀/조직 생성
        4. 바로 음성/화상 통화 사용 시작!
        
        🎯 **Teams vs Mattermost:**
        - ✅ 사용자당 라이선스 비용 없음
        - ✅ 완전한 데이터 소유권
        - ✅ 더 나은 성능 (자체 호스팅)
        - ✅ 완전한 커스터마이징 제어
        
        데이터베이스 비밀번호: $default_pwd
  index: /
  port_map: "3000"
  store_app_id: mattermost