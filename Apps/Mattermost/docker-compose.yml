name: mattermost

services:
  postgres:
    image: postgres:13-alpine
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '0.5'
    volumes:
      - /DATA/AppData/$AppID/postgres:/var/lib/postgresql/data
    environment:
      POSTGRES_USER: mmuser
      POSTGRES_PASSWORD: $default_pwd
      POSTGRES_DB: mattermost
      POSTGRES_INITDB_ARGS: "--encoding=UTF-8"
      PGDATA: /var/lib/postgresql/data/pgdata
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U mmuser -d mattermost"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 120s

  mattermost:
    image: mattermost/mattermost-team-edition:10.9.1
    restart: unless-stopped
    depends_on:
      - postgres
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '1.0'
    expose:
      - 3000
    volumes:
      - /DATA/AppData/$AppID/config:/mattermost/config
      - /DATA/AppData/$AppID/data:/mattermost/data
      - /DATA/AppData/$AppID/logs:/mattermost/logs
      - /DATA/AppData/$AppID/plugins:/mattermost/plugins
    environment:
      PUID: $PUID
      PGID: $PGID
      TZ: $TZ
      
      # Core Database Settings
      MM_SQLSETTINGS_DRIVERNAME: postgres
      MM_SQLSETTINGS_DATASOURCE: postgres://mmuser:$default_pwd@postgres:5432/mattermost?sslmode=disable&connect_timeout=10
      
      # Server Settings for Teams Alternative
      MM_SERVICESETTINGS_SITEURL: "https://3000-$domain"
      MM_SERVICESETTINGS_LISTENADDRESS: ":3000"
      MM_SERVICESETTINGS_ENABLELOCALMODE: true
      MM_SERVICESETTINGS_ALLOWUNTRUSTEDINTERNALCONNECTIONS: true
      MM_SERVICESETTINGS_ENABLEINSECUREOUTGOINGCONNECTIONS: true
      MM_SERVICESETTINGS_ALLOWCORSFROM: "*"
      MM_SERVICESETTINGS_WEBSOCKETURL: ""
      MM_SERVICESETTINGS_ENABLEFILEATTACHMENTS: true
      
      # Teams Alternative Plugin System
      MM_PLUGINSETTINGS_ENABLE: true
      MM_PLUGINSETTINGS_ENABLEUPLOADS: true
      MM_PLUGINSETTINGS_AUTOMATICPREPACKAGEDPLUGINS: true
      MM_PLUGINSETTINGS_ENABLEREMOTEMARKETPLACE: true
      MM_PLUGINSETTINGS_MARKETPLACEURL: "https://api.integrations.mattermost.com"
      
      # Video Conferencing (Teams calls replacement)
      MM_PLUGINSETTINGS_ENABLEJITSI: true
      MM_PLUGINSETTINGS_ENABLEZOOM: true
      
      # File and Media Settings (Teams file sharing)
      MM_FILESETTINGS_MAXFILESIZE: 104857600
      MM_FILESETTINGS_ENABLEFILEATTACHMENTS: true
      MM_FILESETTINGS_ENABLEPUBLICLINK: true
      MM_FILESETTINGS_ENABLEMOBILEUPLOAD: true
      MM_FILESETTINGS_ENABLEMOBILEDOWNLOAD: true
      
      # Team and User Management
      MM_TEAMSETTINGS_ENABLETEAMCREATION: true
      MM_TEAMSETTINGS_ENABLEUSERCREATION: true
      MM_TEAMSETTINGS_ENABLEOPENSERVER: false
      MM_TEAMSETTINGS_RESTRICTCREATIONTDOMAINS: ""
      
      # Notification Settings (Teams alerts replacement)
      MM_NOTIFICATIONSETTINGS_DEFAULTSERVERPUSHENABLED: true
      MM_NOTIFICATIONSETTINGS_DEFAULTCHANNELPUSHENABLED: true
      MM_NOTIFICATIONSETTINGS_DEFAULTDESKTOPNOTIFICATIONSENABLED: true
      MM_NOTIFICATIONSETTINGS_DEFAULTPUSHSTATUS: "mention"
      
      # Email Integration (Teams notifications)
      MM_EMAILSETTINGS_SENDEMAILNOTIFICATIONS: true
      MM_EMAILSETTINGS_ENABLEEMAILBATCHING: true
      MM_EMAILSETTINGS_EMAILBATCHINGBUFFERSIZE: 256
      MM_EMAILSETTINGS_EMAILBATCHINGINTERVAL: 30
      
      # Security and Privacy
      MM_PRIVACYSETTINGS_SHOWEMAILADDRESS: true
      MM_PRIVACYSETTINGS_SHOWFULLNAME: true
      
      # Logging for Teams Migration
      MM_LOGSETTINGS_CONSOLELEVEL: "INFO"
      MM_LOGSETTINGS_FILELEVEL: "INFO"

x-casaos:
  architectures: [amd64, arm64]
  main: mattermost
  webui_port: 3000
  author: Yundera Team
  category: Communication
  description:
    en_us: Complete Microsoft Teams alternative with video calls, file sharing, team collaboration, and enterprise features
    ko_kr: í™”ìƒ í†µí™”, íŒŒì¼ ê³µìœ , íŒ€ í˜‘ì—… ë° ì—”í„°í”„ë¼ì´ì¦ˆ ê¸°ëŠ¥ì„ ê°–ì¶˜ ì™„ì „í•œ Microsoft Teams ëŒ€ì²´ ì†”ë£¨ì…˜
    fr_fr: Alternative complÃ¨te Ã  Microsoft Teams avec appels vidÃ©o, partage de fichiers, collaboration d'Ã©quipe et fonctionnalitÃ©s d'entreprise
    es_es: Alternativa completa a Microsoft Teams con videollamadas, intercambio de archivos, colaboraciÃ³n en equipo y funciones empresariales
    zh_cn: å…·æœ‰è§†é¢‘é€šè¯ã€æ–‡ä»¶å…±äº«ã€å›¢é˜Ÿåä½œå’Œä¼ä¸šåŠŸèƒ½çš„å®Œæ•´Microsoft Teamsæ›¿ä»£æ–¹æ¡ˆ
  developer: Mattermost, Inc.
  icon: https://cdn.jsdelivr.net/gh/Yundera/AppStore@main/Apps/Mattermost/icon.png
  tagline:
    en_us: Enterprise Teams alternative - self-hosted
    ko_kr: ì—”í„°í”„ë¼ì´ì¦ˆ Teams ëŒ€ì²´ - ìì²´ í˜¸ìŠ¤íŒ…
    fr_fr: Alternative Teams d'entreprise - auto-hÃ©bergÃ©e
    es_es: Alternativa Teams empresarial - auto-alojada
    zh_cn: ä¼ä¸šTeamsæ›¿ä»£æ–¹æ¡ˆ - è‡ªæ‰˜ç®¡
  title:
    en_us: Mattermost
    ko_kr: Mattermost
  tips:
    before_install:
      en_us: |
        **Mattermost: Complete Microsoft Teams Replacement**
        
        ğŸš€ **Enterprise Features Pre-configured:**
        - Unlimited messaging & channels
        - Video calls (via plugin marketplace)
        - File sharing up to 100MB
        - Screen sharing capabilities
        - Mobile & desktop apps
        - Advanced notifications
        - Team management tools
        
        ğŸ“‹ **Quick Setup Guide:**
        1. Access: https://3000-mattermost-username.nsl.sh/
        2. Create admin account (first user = system admin)
        3. Create your team/organization
        4. Install plugins from marketplace:
           - Jitsi Meet (video calls)
           - GitHub (code collaboration)
           - Google Drive (file sharing)
           - Zoom (backup video)
        
        ğŸ”§ **Teams Migration Benefits:**
        âœ… No per-user licensing costs
        âœ… Complete data ownership
        âœ… Better performance (local hosting)
        âœ… Advanced customization
        âœ… Enterprise security controls
        âœ… API integrations
        
        ğŸ¯ **Key Difference from Teams:**
        - Plugins installed via System Console â†’ Marketplace
        - More secure (self-hosted)
        - No Microsoft account required
        - Unlimited file storage
        
        **Database Password:** $default_pwd
        **Plugin Marketplace:** Enabled for easy installation
      ko_kr: |
        **Mattermost: ì™„ì „í•œ Microsoft Teams ëŒ€ì²´ì¬**
        
        ğŸš€ **ì‚¬ì „ êµ¬ì„±ëœ ì—”í„°í”„ë¼ì´ì¦ˆ ê¸°ëŠ¥:**
        - ë¬´ì œí•œ ë©”ì‹œì§• ë° ì±„ë„
        - í™”ìƒ í†µí™” (í”ŒëŸ¬ê·¸ì¸ ë§ˆì¼“í”Œë ˆì´ìŠ¤ í†µí•´)
        - ìµœëŒ€ 100MB íŒŒì¼ ê³µìœ 
        - í™”ë©´ ê³µìœ  ê¸°ëŠ¥
        - ëª¨ë°”ì¼ ë° ë°ìŠ¤í¬í†± ì•±
        - ê³ ê¸‰ ì•Œë¦¼ ì‹œìŠ¤í…œ
        - íŒ€ ê´€ë¦¬ ë„êµ¬
        
        ğŸ“‹ **ë¹ ë¥¸ ì„¤ì • ê°€ì´ë“œ:**
        1. ì ‘ì†: https://3000-mattermost-username.nsl.sh/
        2. ê´€ë¦¬ì ê³„ì • ìƒì„± (ì²« ì‚¬ìš©ì = ì‹œìŠ¤í…œ ê´€ë¦¬ì)
        3. íŒ€/ì¡°ì§ ìƒì„±
        4. ë§ˆì¼“í”Œë ˆì´ìŠ¤ì—ì„œ í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜:
           - Jitsi Meet (í™”ìƒ í†µí™”)
           - GitHub (ì½”ë“œ í˜‘ì—…)
           - Google Drive (íŒŒì¼ ê³µìœ )
           - Zoom (ë°±ì—… í™”ìƒ í†µí™”)
        
        ğŸ”§ **Teams ë§ˆì´ê·¸ë ˆì´ì…˜ ì¥ì :**
        âœ… ì‚¬ìš©ìë‹¹ ë¼ì´ì„ ìŠ¤ ë¹„ìš© ì—†ìŒ
        âœ… ì™„ì „í•œ ë°ì´í„° ì†Œìœ ê¶Œ
        âœ… ë” ë‚˜ì€ ì„±ëŠ¥ (ë¡œì»¬ í˜¸ìŠ¤íŒ…)
        âœ… ê³ ê¸‰ ì»¤ìŠ¤í„°ë§ˆì´ì§•
        âœ… ì—”í„°í”„ë¼ì´ì¦ˆ ë³´ì•ˆ ì œì–´
        âœ… API í†µí•© ì§€ì›
        
        ğŸ¯ **Teamsì™€ì˜ ì£¼ìš” ì°¨ì´ì :**
        - ì‹œìŠ¤í…œ ì½˜ì†” â†’ ë§ˆì¼“í”Œë ˆì´ìŠ¤ë¥¼ í†µí•œ í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜
        - ë” ì•ˆì „í•¨ (ìì²´ í˜¸ìŠ¤íŒ…)
        - Microsoft ê³„ì • ë¶ˆí•„ìš”
        - ë¬´ì œí•œ íŒŒì¼ ì €ì¥ì†Œ
        
        **ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸:** $default_pwd
        **í”ŒëŸ¬ê·¸ì¸ ë§ˆì¼“í”Œë ˆì´ìŠ¤:** ì‰¬ìš´ ì„¤ì¹˜ë¥¼ ìœ„í•´ í™œì„±í™”ë¨
  pre-install-cmd: mkdir -p /DATA/AppData/$AppID/config /DATA/AppData/$AppID/data /DATA/AppData/$AppID/logs /DATA/AppData/$AppID/plugins /DATA/AppData/$AppID/postgres && chown -R $PUID:$PGID /DATA/AppData/$AppID
  index: /
  port_map: "3000"
  store_app_id: mattermost