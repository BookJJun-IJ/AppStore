name: immich

services:
  app:
    container_name: immich-server
    image: ghcr.io/immich-app/immich-server:release
    restart: unless-stopped
    volumes:
      - /DATA/Gallery:/usr/src/app/upload
      - /DATA/Downloads:/usr/src/app/external:ro
      - /etc/localtime:/etc/localtime:ro
    environment:
      DB_HOSTNAME: database
      DB_USERNAME: postgres
      DB_PASSWORD: postgres
      DB_DATABASE_NAME: immich
      REDIS_HOSTNAME: redis
      IMMICH_WORKERS_INCLUDE: 'api'
      IMMICH_ENV: production
      LOG_LEVEL: warn
      IMMICH_MACHINE_LEARNING_ENABLED: false
    ports:
      - "2283:2283"
    depends_on:
      - redis
      - database
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 2G
        reservations:
          cpus: '0.25'
          memory: 512M
    networks:
      pcs: null

  database:
    container_name: immich-postgres
    image: docker.io/tensorchord/pgvecto-rs:pg14-v0.2.0
    restart: unless-stopped
    environment:
      POSTGRES_PASSWORD: postgres
      POSTGRES_USER: postgres
      POSTGRES_DB: immich
      POSTGRES_INITDB_ARGS: '--data-checksums'
    volumes:
      - /DATA/AppData/$AppID/database:/var/lib/postgresql/data
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 1G
    networks:
      pcs: null

  redis:
    container_name: immich-redis
    image: docker.io/valkey/valkey:7.2-alpine
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '0.25'
          memory: 256M
    networks:
      pcs: null

networks:
  pcs:
    name: pcs

x-casaos:
  architectures:
    - amd64
    - arm64
  author: self
  category: photos
  description:
    en_us: Immich - CPU optimized photo backup solution. Machine learning disabled for better performance on low-spec systems.
    zh_cn: Immich - CPU优化的照片备份解决方案。禁用机器学习以在低配置系统上获得更好性能。
    ko_kr: Immich - CPU 최적화된 사진 백업 솔루션. 저사양 시스템에서 더 나은 성능을 위해 머신 러닝 비활성화.
  icon: https://raw.githubusercontent.com/BookJJun-IJ/AppStore/create/Apps/Immich/icons.png
  screenshot_link:
    - https://raw.githubusercontent.com/BookJJun-IJ/AppStore/create/Apps/Immich/screenshots1.png
    - https://raw.githubusercontent.com/BookJJun-IJ/AppStore/create/Apps/Immich/screenshots2.png
    - https://raw.githubusercontent.com/BookJJun-IJ/AppStore/create/Apps/Immich/screenshots3.png
  index: /
  tagline:
    en_us: CPU-optimized photo backup with machine learning disabled
    zh_cn: 禁用机器学习的CPU优化照片备份
    ko_kr: 머신 러닝 비활성화로 CPU 최적화된 사진 백업
  port_map: "2283"
  store_app_id: immich
  title:
    en_us: Immich (CPU Optimized)
    zh_cn: Immich (CPU优化版)
    ko_kr: Immich (CPU 최적화)
  main: app
  volumes:
    - /DATA/Gallery
    - /DATA/Downloads
    - /DATA/AppData/$AppID/database