name: immich

services:
  app:
    container_name: immich-server
    image: ghcr.io/immich-app/immich-server:release
    restart: unless-stopped
    volumes:
      - /DATA/Gallery:/usr/src/app/upload
      - /DATA/Downloads:/usr/src/app/external:ro
      - /etc/localtime:/etc/localtime:ro
    environment:
      DB_HOSTNAME: immich-server-database
      DB_USERNAME: postgres
      DB_PASSWORD: postgres
      DB_DATABASE_NAME: immich
      REDIS_HOSTNAME: redis
    ports:
      - "2283:2283"
    depends_on:
      - redis
      - database
      - machine-learning
    networks:
      pcs: null

  database:
    container_name: immich-postgres
    image: docker.io/tensorchord/pgvecto-rs:pg14-v0.2.0
    restart: unless-stopped
    environment:
      POSTGRES_PASSWORD: postgres
      POSTGRES_USER: postgres
      POSTGRES_DB: immich
      POSTGRES_INITDB_ARGS: '--data-checksums'
    volumes:
      - /DATA/AppData/$AppID/database:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -d ${POSTGRES_DB} -U ${POSTGRES_USER}"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      pcs: null

  machine-learning:
    container_name: immich-machine-learning
    image: ghcr.io/immich-app/immich-machine-learning:release
    restart: unless-stopped
    volumes:
      - /DATA/AppData/$AppID/model-cache:/cache
    environment:
      REDIS_HOSTNAME: redis
      MACHINE_LEARNING_CACHE_FOLDER: /cache
    networks:
      pcs: null

  redis:
    container_name: immich-redis
    image: docker.io/valkey/valkey:7.2-alpine
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "valkey-cli ping || exit 1"]
      interval: 30s
      timeout: 3s
      retries: 5
    networks:
      pcs: null

networks:
  pcs:
    name: pcs

x-casaos:
  architectures:
    - amd64
    - arm64
  author: self
  category: photos
  description:
    en_us: Immich - A high-performance, self-hosted photo and video backup solution, featuring on-device machine learning, mobile apps, and a beautiful web interface that feels like Google Photos.
    zh_cn: Immich - 高性能的自托管照片和视频备份解决方案，具有设备上机器学习、移动应用程序和类似Google Photos的美观网页界面。
    ko_kr: Immich - 기기 내 머신 러닝, 모바일 앱 및 Google 포토와 같은 아름다운 웹 인터페이스를 갖춘 고성능 셀프 호스팅 사진 및 비디오 백업 솔루션입니다.
  icon: https://raw.githubusercontent.com/BookJJun-IJ/AppStore/create/Apps/Immich/icons.png
  screenshot_link:
    - https://raw.githubusercontent.com/BookJJun-IJ/AppStore/create/Apps/Immich/screenshots1.png
    - https://raw.githubusercontent.com/BookJJun-IJ/AppStore/create/Apps/Immich/screenshots2.png
    - https://raw.githubusercontent.com/BookJJun-IJ/AppStore/create/Apps/Immich/screenshots3.png
  index: /
  tagline:
    en_us: Self-hosted photo and video backup solution with Google Photos-like experience
    zh_cn: 提供类似Google Photos体验的自托管照片和视频备份解决方案
    ko_kr: Google 포토와 같은 경험을 제공하는 셀프 호스팅 사진 및 비디오 백업 솔루션
  port_map: "2283"
  store_app_id: immich
  title:
    en_us: Immich
    zh_cn: Immich
    ko_kr: Immich
  main: app
  volumes:
    - /DATA/Gallery
    - /DATA/Downloads
    - /DATA/AppData/$AppID/database
    - /DATA/AppData/$AppID/model-cache
  tips:
    en_us: |
      📁 Folder Structure Guide:
      • Photo Storage: /DATA/Gallery
      • Import Photos: /DATA/Downloads
      • Database: /DATA/AppData/immich/database (Do not modify)
      
      🚀 Getting Started:
      • First visit: Create admin account at http://YourServerIP:2283
      • Mobile Apps: Search "Immich" on Play Store / App Store
      • Web Access: http://localhost:2283
      
      💡 Usage Tips:
      • Upload via mobile app → Auto-saved to /DATA/Gallery
      • Copy existing photos to /DATA/Downloads → Use "External Library Scan"
      • AI features may take time during first scan
      
      ⚠️ Important:
      • Never delete database folder
      • Backup is recommended before major updates

    zh_cn: |
      📁 文件夹结构指南：
      • 照片存储：/DATA/Gallery
      • 导入照片：/DATA/Downloads
      • 数据库：/DATA/AppData/immich/database（请勿修改）
      
      🚀 入门指南：
      • 首次访问：在 http://您的服务器IP:2283 创建管理员账户
      • 手机应用：在应用商店搜索"Immich"
      • 网页访问：http://localhost:2283
      
      💡 使用技巧：
      • 通过手机应用上传 → 自动保存到 /DATA/Gallery
      • 将现有照片复制到 /DATA/Downloads → 使用"外部库扫描"
      • AI功能首次扫描可能需要较长时间
      
      ⚠️ 重要提示：
      • 切勿删除数据库文件夹
      • 建议在重大更新前进行备份

    ko_kr: |
      📁 폴더 구조 안내:
      • 사진 저장 위치: /DATA/Gallery
      • 외부 사진 가져오기: /DATA/Downloads
      • 데이터베이스: /DATA/AppData/immich/database (수정 금지)
      
      🚀 시작하기:
      • 첫 접속: http://서버IP:2283 에서 관리자 계정 생성
      • 모바일 앱: Play Store, App Store에서 "Immich" 검색
      • 웹 접속: http://localhost:2283
      
      💡 사용 팁:
      • 모바일 앱으로 업로드 → /DATA/Gallery에 자동 저장
      • 기존 사진을 /DATA/Downloads에 복사 → "외부 라이브러리 스캔" 사용
      • AI 기능 첫 스캔 시 시간이 오래 걸릴 수 있음
      
      ⚠️ 주의사항:
      • 데이터베이스 폴더 절대 삭제 금지
      • 대규모 업데이트 전 백업 권장