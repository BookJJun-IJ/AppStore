name: rocketchat

services:
  mongodb:
    image: mongo:7.0
    user: $PUID:$PGID
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '0.5'
    environment:
      PUID: $PUID
      PGID: $PGID
    volumes:
      - /DATA/AppData/$AppID/mongodb:/data/db
    restart: unless-stopped
    command: mongod --quiet --logpath /dev/null

  rocketchat:
    image: registry.rocket.chat/rocketchat/rocket.chat:7.5.0
    user: $PUID:$PGID
    deploy:
      resources:
        limits:
          memory: 2G
          cpus: '1.0'
    environment:
      MONGO_URL: mongodb://mongodb:27017/rocketchat
      ROOT_URL: http://localhost:80
      PORT: 80
      ADMIN_USERNAME: admin
      ADMIN_PASS: $default_pwd
      ADMIN_EMAIL: admin@localhost
      PUID: $PUID
      PGID: $PGID
      TZ: $TZ
    expose:
      - 80
    volumes:
      - /DATA/AppData/$AppID/uploads:/app/uploads
      - /DATA/AppData/$AppID/data:/app/data
    depends_on:
      - mongodb
    restart: unless-stopped

x-casaos:
    architectures:
        - amd64
        - arm64
    main: rocketchat
    author: CasaOS Team
    category: Backup
    description:
        en_us: Rocket.Chat is an open-source team communication platform. It provides chat, video conferencing, file sharing and collaboration features.
    developer: Rocket.Chat Technologies Corp.
    tagline:
        en_us: Open-source team communication platform
    title:
        en_us: Rocket.Chat
    tips:
        before_install:
            en_us: |
                Default Account
                | Username   | Password       |
                | --------   | ------------   |
                | `admin`    | `$default_pwd` |
    index: /
    webui_port: 80