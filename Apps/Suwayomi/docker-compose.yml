name: suwayomi

services:
  suwayomi:
    image: ghcr.io/suwayomi/tachidesk:v2.0.1727  # ê³µì‹ ìµœì‹  ì´ë¯¸ì§€
    user: $PUID:$PGID
    container_name: suwayomi
    expose:
      - 80
    environment:
      PUID: $PUID
      PGID: $PGID
      TZ: $TZ
      # ê³µì‹ Docker í™˜ê²½ë³€ìˆ˜ ì‚¬ìš© (í¬íŠ¸ ë§µí•‘)
      BIND_IP: 0.0.0.0
      BIND_PORT: 80
      
      # ì¸ì¦ ì„¤ì •
      BASIC_AUTH_ENABLED: true
      BASIC_AUTH_USERNAME: admin
      BASIC_AUTH_PASSWORD: $default_pwd
      
      # ë‹¤ìš´ë¡œë“œ ì„¤ì •
      DOWNLOAD_AS_CBZ: true
      AUTO_DOWNLOAD_CHAPTERS: false  # ìˆ˜ë™ ì œì–´
      AUTO_DOWNLOAD_EXCLUDE_UNREAD: true
      AUTO_DOWNLOAD_NEW_CHAPTERS_LIMIT: 0
      
      # ì—…ë°ì´íŠ¸ ì„¤ì • (ë” ë³´ìˆ˜ì )
      UPDATE_EXCLUDE_UNREAD: true
      UPDATE_EXCLUDE_STARTED: true
      UPDATE_EXCLUDE_COMPLETED: true
      UPDATE_INTERVAL: 0  # ìžë™ ì—…ë°ì´íŠ¸ ë¹„í™œì„±í™”
      UPDATE_MANGA_INFO: false
      
      # WebUI ì„¤ì • - Preview ë²„ì „ (ë””ë°”ì´ìŠ¤ë³„ ì„¤ì • ì§€ì›)
      WEB_UI_ENABLED: true
      WEB_UI_FLAVOR: WebUI
      WEB_UI_CHANNEL: preview  # ðŸ”¥ ë””ë°”ì´ìŠ¤ë³„ ì„¤ì • ê¸°ëŠ¥ì„ ìœ„í•´ preview ì‚¬ìš©
      WEB_UI_UPDATE_INTERVAL: 23
      
      # í™•ìž¥ ì €ìž¥ì†Œ (Keiyoushië§Œ)
      EXTENSION_REPOS: >-
        ["https://raw.githubusercontent.com/keiyoushi/extensions/repo/index.min.json"]
      
      # ì„±ëŠ¥ ì„¤ì •
      MAX_SOURCES_IN_PARALLEL: 3  # ë” ë³´ìˆ˜ì 
      
      # ë°±ì—… ì„¤ì •
      BACKUP_INTERVAL: 7  # ì£¼ê°„ ë°±ì—…
      BACKUP_TTL: 30     # 30ì¼ ë³´ê´€
      
      # FlareSolverr ì—°ë™
      FLARESOLVERR_ENABLED: true
      FLARESOLVERR_URL: http://suwayomi-flaresolverr:8191
      FLARESOLVERR_TIMEOUT: 60
      FLARESOLVERR_SESSION_NAME: suwayomi
      FLARESOLVERR_SESSION_TTL: 15
      
      # ë³´ì•ˆ ì„¤ì •
      DEBUG: false
    volumes:
      # ê³µì‹ ê¶Œìž¥ ë³¼ë¥¨ ìˆœì„œ (downloadsê°€ ë¨¼ì €!)
      - /DATA/Media/Manga:/home/suwayomi/.local/share/Tachidesk/downloads
      - /DATA/AppData/$AppID/data:/home/suwayomi/.local/share/Tachidesk
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: '1.0'
    depends_on:
      - flaresolverr

  flaresolverr:
    image: ghcr.io/flaresolverr/flaresolverr:latest
    container_name: suwayomi-flaresolverr
    user: $PUID:$PGID
    environment:
      PUID: $PUID
      PGID: $PGID
      TZ: $TZ
      LOG_LEVEL: info
      CAPTCHA_SOLVER: none
      # FlareSolverr ìµœì í™”
      BROWSER_TIMEOUT: 40000
      TEST_URL: https://www.google.com
    volumes:
      - /DATA/AppData/$AppID/flaresolverr:/app/data
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '0.5'

x-casaos:
  architectures:
    - amd64
    - arm64
  main: suwayomi
  author: Suwayomi Team
  category: Media
  
  # ðŸš€ ëª¨ë°”ì¼ ë¦¬ë” ì„¤ì • ìžë™ êµ¬ì„±
  pre-install-cmd: |
    # ë°ì´í„° ë””ë ‰í† ë¦¬ ìƒì„±
    mkdir -p /DATA/AppData/$AppID/data
    
    # ì„œë²„ ì„¤ì • íŒŒì¼ ìƒì„± (ê¸°ë³¸ê°’ + í™•ìž¥ì„±)
    cat > /DATA/AppData/$AppID/data/server.conf << 'EOF'
    # Suwayomi ì„œë²„ ì„¤ì •
    server {
      # ê¸°ë³¸ ì¸ì¦ ì„¤ì •
      basicAuthEnabled = true
      basicAuthUsername = "admin"
      
      # WebUI ì„¤ì •
      webUIFlavor = "WebUI"
      webUIChannel = "preview"
      
      # ì‹œìŠ¤í…œ ì„¤ì •
      systemTrayEnabled = false
      initialOpenInBrowserEnabled = false
      debugLogsEnabled = false
      
      # ë‹¤ìš´ë¡œë“œ ê²½ë¡œ
      downloadsPath = "/home/suwayomi/.local/share/Tachidesk/downloads"
    }
    
    # í™•ìž¥ ì„¤ì •
    extension {
      # ì„±ì¸ ì½˜í…ì¸  ì†ŒìŠ¤ ìˆ¨ê¹€
      hideNsfwSources = true
    }
    EOF
    
    # ëª¨ë°”ì¼ ë””ë°”ì´ìŠ¤ ì„¤ì •ì„ ìœ„í•œ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
    cat > /DATA/AppData/$AppID/setup-mobile.sh << 'EOF'
    #!/bin/bash
    
    # Suwayomiê°€ ì‹œìž‘ë  ë•Œê¹Œì§€ ëŒ€ê¸°
    echo "Waiting for Suwayomi to start..."
    sleep 30
    
    # GraphQL APIë¥¼ í†µí•œ ëª¨ë°”ì¼ ë””ë°”ì´ìŠ¤ ì„¤ì •
    # (ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì»¨í…Œì´ë„ˆ ì‹œìž‘ í›„ ì‹¤í–‰ë¨)
    
    # ëª¨ë°”ì¼ ë””ë°”ì´ìŠ¤ ìƒì„± ë° ì„¤ì •
    curl -X POST 'http://localhost:80/api/graphql' \
      -H 'Content-Type: application/json' \
      -H 'Authorization: Basic $(echo -n "admin:$ADMIN_PASSWORD" | base64)' \
      -d '{
        "query": "mutation { 
          createDevice(input: { 
            name: \"Mobile\", 
            settings: {
              readerSettings: {
                readingMode: \"VERTICAL\",
                imageScale: \"FIT_WIDTH\",
                tapZoneEnabled: true,
                pageSpacing: 0
              }
            }
          }) { 
            id 
          } 
        }"
      }' 2>/dev/null
    
    echo "Mobile device settings configured"
    EOF
    
    chmod +x /DATA/AppData/$AppID/setup-mobile.sh
    
    # LocalStorageìš© ëª¨ë°”ì¼ ì„¤ì • JSON íŒŒì¼ ìƒì„±
    mkdir -p /DATA/AppData/$AppID/data/webui-settings
    cat > /DATA/AppData/$AppID/data/webui-settings/mobile-defaults.json << 'EOF'
    {
      "devices": {
        "Mobile": {
          "readerSettings": {
            "readingMode": "VERTICAL",
            "imageScale": "FIT_WIDTH", 
            "tapZoneEnabled": true,
            "pageSpacing": 0,
            "backgroundColor": "#000000",
            "showPageNumber": true,
            "skipDuplicateChapters": true
          },
          "generalSettings": {
            "darkMode": true,
            "language": "en"
          }
        },
        "Desktop": {
          "readerSettings": {
            "readingMode": "SINGLE_PAGE",
            "imageScale": "FIT_SCREEN",
            "tapZoneEnabled": false,
            "pageSpacing": 5
          }
        }
      },
      "defaultDeviceSettings": {
        "mobile": "Mobile",
        "desktop": "Desktop"
      }
    }
    EOF
    
    # ëª¨ë°”ì¼ ì‚¬ìš© ê°€ì´ë“œ ìƒì„±
    cat > /DATA/AppData/$AppID/MOBILE_SETUP.md << 'EOF'
    # ðŸ“± ëª¨ë°”ì¼ ì„¤ì • ê°€ì´ë“œ
    
    ## ìžë™ ì„¤ì •ëœ í•­ëª©ë“¤
    âœ… ì½ê¸° ëª¨ë“œ: Vertical (ì„¸ë¡œ ìŠ¤í¬ë¡¤)
    âœ… ì´ë¯¸ì§€ í¬ê¸°: Fit to Width (í™”ë©´ ë„ˆë¹„ì— ë§žì¶¤)  
    âœ… íƒ­ ì¡´: í™œì„±í™” (ì¢Œìš° íƒ­ìœ¼ë¡œ íŽ˜ì´ì§€ ë„˜ê¹€)
    âœ… íŽ˜ì´ì§€ ê°„ê²©: ìµœì†Œí™” (0px)
    
    ## ì²« ì ‘ì† í›„ í™•ì¸ì‚¬í•­
    1. ì„¤ì • â†’ ì¼ë°˜ â†’ ë””ë°”ì´ìŠ¤ ê´€ë¦¬
    2. "Mobile" ë””ë°”ì´ìŠ¤ê°€ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸
    3. ëª¨ë°”ì¼ì—ì„œ "Mobile" ë””ë°”ì´ìŠ¤ ì„ íƒ
    
    ## ì¶”ê°€ ëª¨ë°”ì¼ ìµœì í™”
    - ë‹¤í¬ ëª¨ë“œ ìžë™ í™œì„±í™”
    - íŽ˜ì´ì§€ ë²ˆí˜¸ í‘œì‹œ
    - ì¤‘ë³µ ì±•í„° ê±´ë„ˆë›°ê¸°
    EOF
    
    # ê¶Œí•œ ì„¤ì •
    chown -R $PUID:$PGID /DATA/AppData/$AppID/
    
  icon: https://cdn.jsdelivr.net/gh/BookJJun-IJ/AppStore@create/Apps/Suwayomi/icon.png
  screenshot_link:
    - https://cdn.jsdelivr.net/gh/BookJJun-IJ/AppStore@create/Apps/Suwayomi/screenshot-1.png
    - https://cdn.jsdelivr.net/gh/BookJJun-IJ/AppStore@create/Apps/Suwayomi/screenshot-2.png
    - https://cdn.jsdelivr.net/gh/BookJJun-IJ/AppStore@create/Apps/Suwayomi/screenshot-3.png
  thumbnail: https://cdn.jsdelivr.net/gh/BookJJun-IJ/AppStore@create/Apps/Suwayomi/screenshot-1.png
  description:
    en_us: |
      Self-hosted manga server that lets you read manga from 1200+ sources on any device. 
      Access your manga library from web browsers, mobile apps, or any OPDS-compatible reader. 
      Pre-configured with mobile-optimized reading settings and trusted manga sources.
  developer: Suwayomi Project
  tagline:
    en_us: Your personal manga server with auto-configured mobile reading
  title:
    en_us: Suwayomi
  tips:
    before_install:
      en_us: |
        **ðŸ” Default Login**
        | Username | Password       |
        | -------- | -------------- |
        | `admin`  | `$default_pwd` |
        
        **ðŸ“± Auto-Configured Mobile Settings**
        âœ… **Vertical reading mode** - Perfect for mobile scrolling
        âœ… **Fit to width scaling** - No horizontal scrolling needed  
        âœ… **Tap zones enabled** - Left/right tap to turn pages
        âœ… **Minimal page spacing** - Maximum reading area
        âœ… **Dark mode default** - Easy on mobile screens
        
        **ðŸŽ¯ First Time Setup**
        1. **Login** with credentials above
        2. **Mobile users**: Settings â†’ Device Management â†’ Select "Mobile"
        3. **Desktop users**: Keep "Desktop" settings (optimized for large screens)
        4. **Install sources**: Settings â†’ Browse â†’ Extensions
        
        **ðŸ“š Recommended Sources**
        MangaDex, Mangakakalot, Mangafire, AsuraScans, Webtoons, Manga Plus
        
        **âš¡ Quick Start**
        - Browse â†’ Install extensions â†’ Add manga â†’ Start reading!
        - Mobile settings already optimized for your phone screen
        - Desktop gets separate settings for comfortable PC reading
  index: /
  webui_port: 80