name: nextcloud

services:
  nextcloud:
    image: nextcloud:30.0.6
    container_name: nextcloud
    user: $PUID:$PGID
    restart: unless-stopped
    depends_on:
      - db
    deploy:
      resources:
        limits:
          memory: 1024M
          cpus: "1.0"
    expose:
      - 80
    environment:
      PUID: $PUID
      PGID: $PGID
      TZ: $TZ
      MYSQL_HOST: db
      MYSQL_DATABASE: nextcloud
      MYSQL_USER: nextcloud
      MYSQL_PASSWORD: $default_pwd
      NEXTCLOUD_ADMIN_USER: admin
      NEXTCLOUD_ADMIN_PASSWORD: $default_pwd
      NEXTCLOUD_TRUSTED_DOMAINS: localhost,$domain
      OVERWRITEPROTOCOL: https
      OVERWRITEHOST: $domain
      TRUSTED_PROXIES: 172.16.0.0/12,10.0.0.0/8,192.168.0.0/16
    volumes:
      - /DATA/AppData/$AppID/html:/var/www/html
      - /DATA/AppData/$AppID/apps:/var/www/html/custom_apps
      - /DATA/AppData/$AppID/config:/var/www/html/config
      - /DATA/AppData/$AppID/data:/var/www/html/data
      - /DATA/Documents:/var/www/html/data/Documents
      - /DATA/Media:/var/www/html/data/Media
      - /DATA/Gallery:/var/www/html/data/Gallery
    networks:
      - nextcloud-network
    cpu_shares: 100

  db:
    image: mariadb:11.2
    container_name: nextcloud_db
    user: $PUID:$PGID
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: "0.5"
    environment:
      PUID: $PUID
      PGID: $PGID
      TZ: $TZ
      MYSQL_ROOT_PASSWORD: $default_pwd
      MYSQL_DATABASE: nextcloud
      MYSQL_USER: nextcloud
      MYSQL_PASSWORD: $default_pwd
      MARIADB_AUTO_UPGRADE: 1
    volumes:
      - /DATA/AppData/$AppID/db:/var/lib/mysql
    networks:
      - nextcloud-network
    cpu_shares: 50

networks:
  nextcloud-network:
    driver: bridge

x-casaos:
  main: nextcloud
  webui_port: 80
  category: Utilities
  architectures: [amd64, arm64]
  author: Yundera Team
  developer: Nextcloud GmbH
  description:
    en_us: Nextcloud is a suite of client-server software for creating and using file hosting services. Access and sync your files, contacts, calendars and communicate and collaborate across your devices.
    ko_kr: Nextcloud는 파일 호스팅 서비스를 만들고 사용하기 위한 클라이언트-서버 소프트웨어 제품군입니다. 모든 기기에서 파일, 연락처, 캘린더에 액세스하고 동기화하며 소통하고 협업하세요.
  title:
    en_us: Nextcloud
    ko_kr: Nextcloud
  tagline:
    en_us: Self-hosted file sync and share platform
    ko_kr: 자체 호스팅 파일 동기화 및 공유 플랫폼
  icon: https://cdn.jsdelivr.net/gh/Yundera/AppStore@main/Apps/Nextcloud/icon.png
  screenshot_link:
    - https://cdn.jsdelivr.net/gh/Yundera/AppStore@main/Apps/Nextcloud/screenshot-1.png
  thumbnail: https://cdn.jsdelivr.net/gh/Yundera/AppStore@main/Apps/Nextcloud/thumbnail.png
  pre-install-cmd: |
    mkdir -p /DATA/AppData/nextcloud/scripts
    cat > /DATA/AppData/nextcloud/scripts/install-apps.sh << 'EOF'
    #!/bin/bash
    echo "앱 설치 스크립트 시작..."
    sleep 120
    
    docker exec nextcloud php /var/www/html/occ app:enable calendar || true
    docker exec nextcloud php /var/www/html/occ app:enable contacts || true
    docker exec nextcloud php /var/www/html/occ app:enable mail || true
    docker exec nextcloud php /var/www/html/occ app:enable spreed || true
    docker exec nextcloud php /var/www/html/occ app:enable deck || true
    docker exec nextcloud php /var/www/html/occ app:enable tasks || true
    docker exec nextcloud php /var/www/html/occ app:install richdocuments || true
    docker exec nextcloud php /var/www/html/occ app:enable richdocuments || true
    
    echo "앱 설치 완료" > /DATA/AppData/nextcloud/scripts/install-complete.log
    EOF
    
    chmod +x /DATA/AppData/nextcloud/scripts/install-apps.sh
    nohup /DATA/AppData/nextcloud/scripts/install-apps.sh > /DATA/AppData/nextcloud/scripts/install.log 2>&1 &
  tips:
    before_install:
      en_us: |
        **Default Account**
        | Username | Password       |
        | -------- | -------------- |
        | `admin`  | `$default_pwd` |
        
        **Setup Steps:**
        1. Access web interface after installation
        2. Login with admin credentials above
        3. Wait 2-3 minutes for automatic app installation
        4. Essential collaboration apps will be enabled automatically
        
        **Auto-Enabled Apps:**
        - Calendar, Contacts, Mail
        - Talk (Video conferencing)
        - Deck (Project boards)
        - Tasks, Nextcloud Office
      ko_kr: |
        **기본 계정**
        | 사용자명 | 비밀번호       |
        | -------- | -------------- |
        | `admin`  | `$default_pwd` |
        
        **설정 단계:**
        1. 설치 후 웹 인터페이스 접속
        2. 위 관리자 자격증명으로 로그인
        3. 자동 앱 설치를 위해 2-3분 대기
        4. 필수 협업 앱이 자동으로 활성화됨
        
        **자동 활성화 앱:**
        - Calendar, Contacts, Mail
        - Talk (화상회의)
        - Deck (프로젝트 보드)
        - Tasks, Nextcloud Office
  index: /